<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midi Player</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script src="script.js"></script>
    <script src="midi_player.js"></script>
    <script> function goToMainMenu() {window.location.href = "index.html";}</script>
    <button id="backButton" onclick="goToMainMenu()">> main_menu</button>
    <div class="content">
        <p>
            Midi Player | 11-04-2025
        </p>
        This is a work in progress. Upload your midi file here to have them played back.
        <br>
        <input type="file" id="midi-upload" accept=".mid,.midi" onchange="handleMidiUpload(this.files[0])">
    </div>
</body>
</html>

<script>
    window.handleMidiUpload = async function(file) {
        const arrayBuffer = await file.arrayBuffer()
        const midi = new Midi(arrayBuffer)
        const synth = new Synthesizer(midi, 0.3)
        let last = performance.now()
        function loop(t) {
            const dt = (t - last) / 1000
            last = t
            synth.run(dt)
            requestAnimationFrame(loop)
        }
        requestAnimationFrame(loop)
    }
</script>
    

